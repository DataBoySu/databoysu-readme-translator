name: CI

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create Dummy README
        run: |
          echo "# Test Project" > TEST_README.md
          echo "This is a test description for the AI translator." >> TEST_README.md
          echo "## Features" >> TEST_README.md
          echo "- Fast translation" >> TEST_README.md

      - name: Run Translator Action (French)
        uses: ./ # Uses the action from the current repository
        with:
          lang: 'fr'
          readme_path: 'TEST_README.md'

      - name: Verify Output
        run: |
          if [ ! -f "locales/README.fr.md" ]; then
            echo "Error: Translation file not generated."
            exit 1
          fi
          
          # Check if Navbar was injected into the source README
          if ! grep -q "<!--START_SECTION:navbar-->" TEST_README.md; then
            echo "Error: Navbar not injected into TEST_README.md"
            exit 1
          fi
          
          echo "Translation and Navbar verification passed."
